% Package imports
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

% Times New Roman font
\usepackage{mathptmx} % Times font for text and math
\usepackage{txfonts} % Alternative Times implementation

% Page margins: top, bottom, right 2.0cm and left 2.5cm
\usepackage[
    top=2.0cm,
    bottom=2.0cm,
    left=2.5cm,
    right=2.0cm,
    a4paper
]{geometry}

% Text justification and paragraph settings
\usepackage{ragged2e}
\usepackage{setspace}
\usepackage{indentfirst} % Indent first paragraph after section
\setstretch{1.25} % 1.25 line spacing for whole document
\justifying % Justify text alignment
\setlength{\parindent}{1.25cm} % 1.25cm indent for paragraphs

% Page numbering in footer, bottom-left
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{} % Clear all header and footer fields
\fancyfoot[R]{\thepage} % Page number in bottom-left
\renewcommand{\headrulewidth}{0pt} % Remove header line
\renewcommand{\footrulewidth}{0pt} % Remove footer line

% Diagram and schematic packages
\usepackage{tikz}
\usetikzlibrary{shapes.geometric, arrows.meta, positioning, automata, fit, calc}
\usepackage{siunitx} % For SI units
\usepackage[american, siunitx]{circuitikz}

% Additional useful packages
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{caption}
\usepackage{float}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{enumitem}
\usepackage{accsupp} % For non-selectable line numbers

% Code listing configuration
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen},
    keywordstyle=\color{blue},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=t,
    keepspaces=true,
    numbers=none,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=4,
    frame=single,
    aboveskip=1.0em,
    belowskip=0em,
    columns=flexible
}

\lstset{style=mystyle}

% Define JSON language for listings
\lstdefinelanguage{json}{
    basicstyle=\ttfamily\footnotesize,
    numbers=none,
    numberstyle=\footnotesize,
    stepnumber=1,
    numbersep=8pt,
    showstringspaces=false,
    breaklines=true,
    frame=single,
    backgroundcolor=\color{backcolour},
    string=[s]{"}{"},
    stringstyle=\color{codepurple},
    comment=[l]{:},
    commentstyle=\color{black},
    morecomment=[l]{//},
    morecomment=[s]{/*}{*/},
    literate=
     *{0}{{{\color{blue}0}}}{1}
      {1}{{{\color{blue}1}}}{1}
      {2}{{{\color{blue}2}}}{1}
      {3}{{{\color{blue}3}}}{1}
      {4}{{{\color{blue}4}}}{1}
      {5}{{{\color{blue}5}}}{1}
      {6}{{{\color{blue}6}}}{1}
      {7}{{{\color{blue}7}}}{1}
      {8}{{{\color{blue}8}}}{1}
      {9}{{{\color{blue}9}}}{1}
      {:}{{{\color{black}{:}}}}{1}
      {,}{{{\color{black}{,}}}}{1}
      {\{}{{{\color{black}{\{}}}}{1}
      {\}}{{{\color{black}{\}}}}}{1}
      {[}{{{\color{black}{[}}}}{1}
      {]}{{{\color{black}{]}}}}{1},
}

% Enable WebP support (requires shell-escape)
\usepackage{shellesc}
\DeclareGraphicsRule{.webp}{png}{.png}{`convert #1 png:-}

% Listing name must be set before caption setup
\renewcommand{\lstlistingname}{Listing}

% Figure caption formatting - italic with "Figure X -- title"
\DeclareCaptionFormat{figureformat}{\textit{\textbf{#1}#2-- #3}}
\captionsetup[figure]{
  format=figureformat,
  labelsep=space,
  font={normalsize,it},
  labelfont={normalsize,it},
  name=Figure
}

% Listing caption formatting - italic with "Listing X -- title"
\DeclareCaptionFormat{listingformat}{\textit{\textbf{#1}#2-- #3}}
\captionsetup[lstlisting]{
  format=listingformat,
  labelsep=space,
  font={normalsize,it},
  labelfont={normalsize,it}
}

% Custom command for citing figures - \citeimg{label}
\newcommand{\citeimg}[1]{\textit{\autoref{#1}}}

% Custom command for citing listings - \citelst{label}
\newcommand{\citelst}[1]{\textit{\autoref{#1}}}

% Redefine autoref to show "Figure" and "Listing" instead of default
\renewcommand{\figureautorefname}{Figure}
\renewcommand{\lstlistingname}{Listing}
\providecommand*{\lstlistingautorefname}{Listing}

% Figure and listing numbering based on section (e.g., 1.1, 1.2)
\makeatletter
\@addtoreset{figure}{section}
\renewcommand{\thefigure}{\thesection.\arabic{figure}}
\AtBeginDocument{%
  \@addtoreset{lstlisting}{section}%
  \renewcommand{\thelstlisting}{\thesection.\arabic{lstlisting}}%
}
\makeatother

% Section formatting - section 16pt, subsection 14pt, subsubsection 12pt
\usepackage{titlesec}
\titleformat{\section}
  {\normalfont\fontsize{16}{19.2}\selectfont\bfseries}{\thesection.}{1em}{}
\titleformat{\subsection}
  {\normalfont\fontsize{14}{16.8}\selectfont\bfseries}{\thesubsection.}{1em}{}
\titleformat{\subsubsection}
  {\normalfont\fontsize{12}{14.4}\selectfont\bfseries}{} {1em}{}
